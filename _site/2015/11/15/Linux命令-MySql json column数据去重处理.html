<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/blog/ie.html"><![endif]--> <title>Linux命令-MySql json column数据去重处理</title> <meta name="description" content="先说需求公司某项目数据存储在MySql中值是一个Json字符串例如:"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/blog/css/main.css"> <link rel="canonical" href="http://yzhengfei.github.io/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html"> <link rel="alternate" type="application/rss+xml" title="Welcome | 尹正飞的博客" href="http://yzhengfei.github.io/blog/feed.xml" /> <script src="/blog/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/blog/"> <img id="sidebar-avatar-img" alt="" src="/blog/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/blog/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:657812595@qq.com" class="sidebar-social-icon email"></a> <a href="https://github.com/yzhengfei" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="微信营销打假">微信营销打假</li> <li class="sidebar-tag" data-filter="Linux命令">Linux命令</li> <li class="sidebar-tag" data-filter="Extjs5">Extjs5</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="Linux命令" href="/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html"> Linux命令-MySql json column数据去重处理 </a> <a class="toc-link" data-tags="Extjs5" href="/blog/2015/10/14/Extjs5-Ext.form.field.Tag%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%AE%9E%E7%8E%B0filter%E5%8A%A0%E8%BD%BD.html"> Extjs5-Ext.form.field.Tag初始化数据实现filter加载 </a> <a class="toc-link" data-tags="Linux命令" href="/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html"> Linux命令-MySql binlog分析示例 </a> <a class="toc-link" data-tags="微信营销打假" href="/blog/2015/09/26/%E5%BE%AE%E4%BF%A1%E8%90%A5%E9%94%80%E6%89%93%E5%81%87-%E5%91%A8%E5%A4%A7%E7%A6%8F%E9%9B%86%E6%9C%88%E9%A5%BC.html"> 微信营销打假-周大福集月饼 </a> <a class="toc-link" data-tags="微信营销打假" href="/blog/2015/08/25/%E5%BE%AE%E4%BF%A1%E8%90%A5%E9%94%80%E6%89%93%E5%81%87-%E8%BD%A6%E8%BD%AE%E8%80%83%E9%A9%BE%E7%85%A7%E9%9B%86%E5%AD%97%E9%80%81%E5%AD%A6%E9%A9%BE%E7%85%A7%E8%B4%B9%E7%94%A8.html"> 微信营销打假-车轮考驾照集字送学驾照费用 </a> </nav> </div> </aside> <main id="main"> <div class="post container"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2015 November 15</span> <span class="post-meta-span tag">Linux命令</span> </div> <h1 class="post-title">Linux命令-MySql json column数据去重处理</h1> <h2>先说需求</h2> <p>公司某项目数据存储在MySql中值是一个Json字符串 例如:</p> <div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;main_position&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;name_en&quot;</span><span class="p">:</span> <span class="s2">&quot; Centre Back &quot;</span>
    <span class="p">},</span> 
    <span class="nt">&quot;side_position&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;name_en&quot;</span><span class="p">:</span> <span class="s2">&quot;Defensive Midfield &quot;</span>
        <span class="p">},</span> 
        <span class="p">{</span>
            <span class="nt">&quot;name_en&quot;</span><span class="p">:</span> <span class="s2">&quot;Left-Back &quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div> <p>现要将name_en这个字段做去重处理,看看到底有多少种类型</p> <h2>解决方法</h2> <p>1.写代码,通过程序去读这个字段值,然后做去重处理</p> <p>2.通过linux命令做去重处理</p> <p>1和2都能实现此功能,但是从速度上来说(不是性能哦,具体性能方面我没有做过测试),2这种方式比较简便,那我们按照第2种方式来实现</p> <h2>具体实现</h2> <p>1.将数据库字段值导出到一个文本文件</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">mysql -uroot -p -h192.168.9.42 -e <span class="s2">&quot;select position from table_name where position is not null&quot;</span> db_name &gt; data.txt
</code></pre></div> <p>导出的文件内容如下</p> <div class="highlight"><pre><code class="language-text" data-lang="text">position
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Centre Back &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Centre Back &quot;},&quot;side_position&quot;:[{&quot;name_en&quot;:&quot;Right-Back &quot;}]}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
{&quot;main_position&quot;:{&quot;name_en&quot;:&quot; Keeper &quot;}}
......
......
......
</code></pre></div> <p>2.逐行解析json字符串</p> <p>linux处理json命令有好多,我这里选择<a href="http://stedolan.github.io/jq/">jq</a>,具体安装方法详见这里<a href="https://stedolan.github.io/jq/download/">安装方法</a></p> <p>注:jq版本大于等于1.4,不然filter中?号用不了</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">awk <span class="s1">&#39; NR != 1 {print $0}&#39;</span> data.txt <span class="p">|</span> jq <span class="s2">&quot;.main_position.name_en, .side_position[]?.name_en&quot;</span> <span class="p">|</span>sed -e <span class="s1">&#39;s/^&quot;*\s*//g&#39;</span> -e <span class="s1">&#39;s/\s*&quot;*$//g&#39;</span><span class="p">|</span>sort -u
</code></pre></div> <p>解释一下:</p> <ul> <li><p>awk &#39; NR != 1 {print $0}&#39; data.txt 主要是去逐行读取刚才从数据库中导出的数据,从第二行开始读</p></li> <li><p>jq &quot;.main<em>position.name</em>en, .side<em>position[]?.name</em>en&quot; 将main<em>position下的name</em>en字段值和side<em>position数组下的name</em>en值解析出来</p></li> <li><p>sed -e &#39;s/^&quot;<em>\s</em>//g&#39; -e &#39;s/\s<em>&quot;</em>$//g&#39; 将解析出值中的双引号和前后空格替换为空字符串</p></li> <li><p>sort -u 排序去重</p></li> </ul> <h2>Show Time</h2> <p>看一下最终执行结果</p> <p><img src="http://7xnxev.com1.z0.glb.clouddn.com/2015-11-15/2015-11-15%2016%3A10%3A52.png" alt="结果"></p> <p>比写代码快多了吧</p> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://yzhengfei.github.io/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html&text=Linux命令-MySql json column数据去重处理" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://yzhengfei.github.io/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html&title=Linux命令-MySql json column数据去重处理" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://yzhengfei.github.io/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html&title=Linux命令-MySql json column数据去重处理" target="_blank" class="post-share-icon weibo"></a> </div> </div> </div> <!-- <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> --> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/blog/assets/js/jquery-2.1.3.min.js"></script> <script src="/blog/assets/js/jquery.pjax.js"></script> <script src="/blog/assets/js/nprogress.js"></script> <script src="/blog/assets/js/main.js"></script> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?60c42d56356d1300d9cb60ae39b0a5a4"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> </body> </html>
