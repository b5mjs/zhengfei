<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/blog/ie.html"><![endif]--> <title>Linux命令-MySql binlog分析示例</title> <meta name="description" content="话说公司项目用到阿里开源项目Otter,一直运行没有问题,突然今天出现了数据不一致的情况,主库数据正常,从库数据出现了重复,问从库的业务方是否自己人工操作或者有程序在后边运行没,说他们那边没有的,所以想来想去,还是看binlog是否有操作过,如果binlog存在记录,那就说明同步出现了问题,如果不存在,肯定是业务..."> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/blog/css/main.css"> <link rel="canonical" href="http://yzhengfei.github.io/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html"> <link rel="alternate" type="application/rss+xml" title="Welcome | 尹正飞的博客" href="http://yzhengfei.github.io/blog/feed.xml" /> <script src="/blog/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/blog/"> <img id="sidebar-avatar-img" alt="" src="/blog/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/blog/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:657812595@qq.com" class="sidebar-social-icon email"></a> <a href="https://github.com/yzhengfei" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="微信营销打假">微信营销打假</li> <li class="sidebar-tag" data-filter="Linux命令">Linux命令</li> <li class="sidebar-tag" data-filter="Extjs5">Extjs5</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="微信营销打假" href="/blog/2015/11/16/%E5%BE%AE%E4%BF%A1%E8%90%A5%E9%94%80%E6%89%93%E5%81%87-%E6%90%BA%E7%A8%8B%E5%B8%AE%E5%BF%99%E7%A0%8D%E4%B8%80%E5%88%80.html"> 微信营销打假-携程帮忙砍一刀 </a> <a class="toc-link" data-tags="Linux命令" href="/blog/2015/11/15/Linux%E5%91%BD%E4%BB%A4-MySql%20json%20column%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E5%A4%84%E7%90%86.html"> Linux命令-MySql json column数据去重处理 </a> <a class="toc-link" data-tags="Extjs5" href="/blog/2015/10/14/Extjs5-Ext.form.field.Tag%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%AE%9E%E7%8E%B0filter%E5%8A%A0%E8%BD%BD.html"> Extjs5-Ext.form.field.Tag初始化数据实现filter加载 </a> <a class="toc-link" data-tags="Linux命令" href="/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html"> Linux命令-MySql binlog分析示例 </a> <a class="toc-link" data-tags="微信营销打假" href="/blog/2015/09/26/%E5%BE%AE%E4%BF%A1%E8%90%A5%E9%94%80%E6%89%93%E5%81%87-%E5%91%A8%E5%A4%A7%E7%A6%8F%E9%9B%86%E6%9C%88%E9%A5%BC.html"> 微信营销打假-周大福集月饼 </a> <a class="toc-link" data-tags="微信营销打假" href="/blog/2015/08/25/%E5%BE%AE%E4%BF%A1%E8%90%A5%E9%94%80%E6%89%93%E5%81%87-%E8%BD%A6%E8%BD%AE%E8%80%83%E9%A9%BE%E7%85%A7%E9%9B%86%E5%AD%97%E9%80%81%E5%AD%A6%E9%A9%BE%E7%85%A7%E8%B4%B9%E7%94%A8.html"> 微信营销打假-车轮考驾照集字送学驾照费用 </a> </nav> </div> </aside> <main id="main"> <div class="post container"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2015 October 12</span> <span class="post-meta-span tag">Linux命令</span> </div> <h1 class="post-title">Linux命令-MySql binlog分析示例</h1> <p>话说公司项目用到阿里开源项目<a href="https://github.com/alibaba/otter">Otter</a>,一直运行没有问题,突然今天出现了数据不一致的情况,主库数据正常,从库数据出现了重复,问从库的业务方是否自己人工操作或者有程序在后边运行没,说他们那边没有的,所以想来想去,还是看binlog是否有操作过,如果binlog存在记录,那就说明同步出现了问题,如果不存在,肯定是业务方那边有数据操作,废话不多说,开始操作.</p> <h1>Step-1:找到binlog日志目录</h1> <p>一般mysql的配置文件在/etc/my.cnf</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">cat /etc/my.cnf
</code></pre></div> <p><img src="/blog/assets/img/2015-10-12/2015-10-12%2014:24:44.png" alt="/etc/my.cof"> log_bin对应的参数就为binlog文件存放的目录(/data0/db-binlog/test/passport/)</p> <h1>Step-2: 使用mysqlbinlog命令提取二进制日志</h1> <p>我的测试环境binlog日志并不多,定期的会删除,如下图 <img src="/blog/assets/img/2015-10-12/2015-10-12%2014:38:49.png" alt="binlog日志列表"></p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">mysqlbinlog --start-datetime<span class="o">=</span><span class="s1">&#39;2015-04-22 20:51:00&#39;</span> --stop-datetime<span class="o">=</span><span class="s1">&#39;2015-04-22 21:01:00&#39;</span> --base64-output -v mysql-bin.000022 &gt; temp-file.1
</code></pre></div> <p>--start-datetime:sql执行开始时间<br> --stop-datetime:sql执行结束时间<br> mysql-bin.000022:binlog日志文件名<br> temp-file.1:转换后的日志文件名 </p> <p>例如:将多个binlog二进制日志文件提取到zhengfei.tmp.1文件 <img src="/blog/assets/img/2015-10-12/2015-10-12%2015:22:56.png" alt="binlog日志列表"></p> <p>注意:binlog日志很大的话,执行此命令比较慢,请耐心等待,如果有好的方法的话可以推荐给我,多谢啦!!!</p> <h1>Step-3:从日志文件中过滤自己有用的信息</h1> <p>转换后的文件我们就可以通过head tail tailf等命令查看了,如果日志文件很大的化,不要用vi vim cat等命令查看,结果么,你懂的</p> <p>我现在要查对某个数据库的某张表执行sql insert语句,如下:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash">grep -A <span class="m">35</span> <span class="s1">&#39;### INSERT INTO `test_db_name`.`test_table_name`&#39;</span> zhengfei.tmp.1 &gt; zhengfei.tmp.2
</code></pre></div> <p>-A:匹配到这行数据向下35行都显示(数字根据自己的数据结构自己调整)<br> 单引号里面内容为匹配内容<br> zhengfei.tmp.1:要匹配的文件<br> zhengfei.tmp.2:匹配的结果 </p> <p>例如:这是我匹配到的其中一条数据 <img src="/blog/assets/img/2015-10-12/2015-10-12%2015:49:39.png" alt="这是我匹配到的其中一条数据"></p> <p>当我匹配到这些数据后,我想匹配ID为5356的数据 <img src="/blog/assets/img/2015-10-12/2015-10-12%2016:07:51.png" alt="这是我匹配到的其中一条数据"></p> <p>-A:向下打印多少行<br> -B:向上打印多少行 </p> <h1>总结</h1> <p>对于此次日志分析,otter同步没有问题(这么牛逼的东东,怎能出现这种问题),可以判断是业务方那边出了问题.</p> <p>对于各位可以根据自己的需求做出灵活的应用,祝你好运!!!</p> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://yzhengfei.github.io/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html&text=Linux命令-MySql binlog分析示例" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://yzhengfei.github.io/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html&title=Linux命令-MySql binlog分析示例" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://yzhengfei.github.io/blog/2015/10/12/Linux%E5%91%BD%E4%BB%A4-MySql%20binlog%E5%88%86%E6%9E%90%E7%A4%BA%E4%BE%8B.html&title=Linux命令-MySql binlog分析示例" target="_blank" class="post-share-icon weibo"></a> </div> </div> </div> <!-- <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> --> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/blog/assets/js/jquery-2.1.3.min.js"></script> <script src="/blog/assets/js/jquery.pjax.js"></script> <script src="/blog/assets/js/nprogress.js"></script> <script src="/blog/assets/js/main.js"></script> <script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "//hm.baidu.com/hm.js?60c42d56356d1300d9cb60ae39b0a5a4"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script> </body> </html>
